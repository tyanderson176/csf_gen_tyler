import sys
sys.path.append('/home/tanderson/Projects/dmc/dmc/')
import p2d
import dmc
import subprocess
from pyscf import scf, gto, mcscf

mol = gto.Mole()
#mol.atom = 'H 0 0 1; N 0 0 0; H 1 0 0; H 0 1 0'
mol.unit = 'bohr'
mol.atom = 'N 0 0 -1; N 0 0 1'
#mol.basis = {'N': gto.basis.parse(
'''
N	S
174008.4676367	0.000032071854	0.000000000000	0.000000000000
 31961.0505639  0.000180868724	0.000000000000	0.000000000000
  8955.6223996  0.000715732871	0.000000000000	0.000000000000
  3086.6056061  0.002327137410 	0.000000000000 	0.000000000000
  1211.0507541  0.006621033466	0.000000000000	0.000000000000
   520.4803348  0.016968581946	0.000000000000	0.000000000000
   239.5622713  0.039565969540	0.000000000000	0.000000000000
   116.3788770  0.083424650726 	0.000000000000 	0.000000000000
    59.0697189  0.155102805406	0.000000000000	0.000000000000
    31.0883910  0.241346852708	0.000000000000	0.000000000000
    16.8589704  0.286294283519	0.000000000000	0.000000000000
     9.3582030  0.220624522944 	0.000000000000 	0.000000000000
     5.2622415  0.083307088014  0.000000000000  0.000000000000
     2.9157824  0.008488240712  0.000000000000  0.000000000000
 75949.5640194	0.000000000000	0.000032071854	0.000000000000
 13950.0559306	0.000000000000  0.000180868724  0.000000000000
  3908.8650455	0.000000000000  0.000715732871  0.000000000000
  1347.2123125 	0.000000000000  0.002327137410  0.000000000000
   528.5879362	0.000000000000  0.006621033466  0.000000000000
   227.1743154	0.000000000000  0.016968581946  0.000000000000
   104.5618659	0.000000000000  0.039565969540 	0.000000000000
    50.7959474 	0.000000000000  0.083424650726 	0.000000000000
    25.7821901	0.000000000000  0.155102805406 	0.000000000000
    13.5691658	0.000000000000  0.241346852708 	0.000000000000
     7.3584434	0.000000000000  0.286294283519 	0.000000000000
     4.0845796 	0.000000000000  0.220624522944 	0.000000000000
     2.2968132  0.000000000000  0.083307088014 	0.000000000000
     1.2726530  0.000000000000  0.008488240712 	0.000000000000
294918.4680412	0.000000000000	0.000000000000	0.000032071854
 54169.2263447	0.000000000000	0.000000000000  0.000180868724
 15178.4477750	0.000000000000	0.000000000000  0.000715732871
  5231.3373548 	0.000000000000 	0.000000000000  0.002327137410
  2052.5508786	0.000000000000	0.000000000000  0.006621033466
   882.1367436	0.000000000000	0.000000000000  0.016968581946
   406.0224139	0.000000000000	0.000000000000  0.039565969540
   197.2448846 	0.000000000000 	0.000000000000  0.083424650726
   100.1143867	0.000000000000	0.000000000000  0.155102805406
    52.6901982	0.000000000000	0.000000000000  0.241346852708
    28.5734470	0.000000000000	0.000000000000  0.286294283519
    15.8607619 	0.000000000000 	0.000000000000  0.220624522944
     8.9187166  0.000000000000  0.000000000000  0.083307088014
     4.9418175  0.000000000000  0.000000000000  0.008488240712

N	S
57555.6909830	-0.000012553657	0.000000000000	0.000000000000  
10586.3659539	-0.000070674213	0.000000000000	0.000000000000
 2967.9720407	-0.000279006252	0.000000000000	0.000000000000
 1023.1143555	-0.000902551677	0.000000000000	0.000000000000
  401.2824073	-0.002539637688	0.000000000000	0.000000000000
  172.1656363	-0.006358497668	0.000000000000	0.000000000000
   78.8676406	-0.014091245591	0.000000000000	0.000000000000
   37.9429956	-0.026247761699	0.000000000000	0.000000000000
   18.9782189	-0.033835499906	0.000000000000	0.000000000000
    5.2863704	 0.136316565351	0.000000000000	0.000000000000
    2.9448995	 0.346615099999	0.000000000000	0.000000000000
    1.6922207	 0.394391440628	0.000000000000	0.000000000000
    0.9917276	 0.179466944874 0.000000000000 	0.000000000000
    0.5759943	 0.019147909853	0.000000000000	0.000000000000
18359.219324	0.0000000000000	-0.000012553657	0.000000000000
 3376.858327	0.0000000000000	-0.000070674213	0.000000000000
  946.729136	0.0000000000000	-0.000279006252	0.000000000000
  326.354883	0.0000000000000	-0.000902551677	0.000000000000
  128.001794	0.0000000000000	-0.002539637688	0.000000000000
   54.917708	0.0000000000000	-0.006358497668	0.000000000000
   25.157343	0.0000000000000	-0.014091245591	0.000000000000
   12.103126	0.0000000000000	-0.026247761699	0.000000000000
    6.053706	0.0000000000000	-0.033835499906	0.000000000000
    1.686256	0.0000000000000	 0.136316565351	0.000000000000
    0.939369	0.0000000000000	 0.346615099999	0.000000000000
    0.539787	0.0000000000000	 0.394391440628	0.000000000000
    0.316343 	0.0000000000000	 0.179466944874	0.000000000000
    0.183731	0.0000000000000	 0.019147909853	0.000000000000
 7274.8831762	0.0000000000000	0.0000000000000	-0.000012553657
 1338.0879329	0.0000000000000	0.0000000000000	-0.000070674213
  375.1436130	0.0000000000000	0.0000000000000	-0.000279006252
  129.3188785	0.0000000000000	0.0000000000000	-0.000902551677
   50.7210075	0.0000000000000	0.0000000000000	-0.002539637688
   21.7612693	0.0000000000000	0.0000000000000	-0.006358497668
    9.9686558	0.0000000000000	0.0000000000000	-0.014091245591
    4.7958917	0.0000000000000	0.0000000000000	-0.026247761699
    2.3987954	0.0000000000000	0.0000000000000	-0.033835499906
    0.6681829	0.0000000000000	0.0000000000000	 0.136316565351
    0.3722273	0.0000000000000	0.0000000000000  0.346615099999
    0.2138921	0.0000000000000	0.0000000000000  0.394391440628
    0.1253517	0.0000000000000	0.0000000000000  0.179466944874
    0.0728041	0.0000000000000	0.0000000000000	 0.019147909853

N	P
 4041.2059609      0.000013589949	0.0000000000000	0.0000000000000	0.0000000000000
 1055.8835276      0.000098737858	0.0000000000000	0.0000000000000	0.0000000000000
  379.3155079      0.000479801845	0.0000000000000	0.0000000000000	0.0000000000000
  159.9008637      0.001857311798	0.0000000000000	0.0000000000000	0.0000000000000
   74.5939360      0.006124920625	0.0000000000000	0.0000000000000	0.0000000000000
   37.3849508      0.017694065197	0.0000000000000	0.0000000000000	0.0000000000000
   19.7796784      0.045024238144	0.0000000000000	0.0000000000000	0.0000000000000
   10.9214987      0.099589645015	0.0000000000000	0.0000000000000	0.0000000000000
    6.2422476      0.185117675279	0.0000000000000	0.0000000000000	0.0000000000000
    3.6698096      0.272215006419	0.0000000000000	0.0000000000000	0.0000000000000
    2.2066738      0.287038979472	0.0000000000000	0.0000000000000	0.0000000000000
    1.3485004      0.185359431716	0.0000000000000	0.0000000000000	0.0000000000000
    0.8289261      0.055951602281	0.0000000000000	0.0000000000000	0.0000000000000
    0.4992483      0.004428704232	0.0000000000000	0.0000000000000	0.0000000000000
 1034.2870197      0.0000000000000	0.000013589949	0.0000000000000	0.0000000000000
  270.2378046      0.0000000000000	0.000098737858	0.0000000000000	0.0000000000000
   97.0802058      0.0000000000000	0.000479801845	0.0000000000000	0.0000000000000
   40.9242660      0.0000000000000	0.001857311798	0.0000000000000	0.0000000000000
   19.0912170      0.0000000000000	0.006124920625	0.0000000000000	0.0000000000000
    9.5681264      0.0000000000000	0.017694065197	0.0000000000000	0.0000000000000
    5.0623167      0.0000000000000	0.045024238144	0.0000000000000	0.0000000000000
    2.7951964      0.0000000000000	0.099589645015	0.0000000000000	0.0000000000000
    1.5976111      0.0000000000000	0.185117675279	0.0000000000000	0.0000000000000
    0.9392336      0.0000000000000	0.272215006419	0.0000000000000	0.0000000000000
    0.5647656      0.0000000000000	0.287038979472	0.0000000000000	0.0000000000000
    0.3451288      0.0000000000000	0.185359431716	0.0000000000000	0.0000000000000
    0.2121514      0.0000000000000	0.055951602281	0.0000000000000	0.0000000000000
    0.1277752      0.0000000000000	0.004428704232	0.0000000000000	0.0000000000000
  369.5995920      0.0000000000000	0.0000000000000 0.000013589949	0.0000000000000
   96.5687284      0.0000000000000	0.0000000000000 0.000098737858	0.0000000000000
   34.6913417      0.0000000000000	0.0000000000000 0.000479801845	0.0000000000000
   14.6241727      0.0000000000000	0.0000000000000 0.001857311798	0.0000000000000
    6.8221933      0.0000000000000	0.0000000000000 0.006124920625	0.0000000000000
    3.4191434      0.0000000000000	0.0000000000000 0.017694065197	0.0000000000000
    1.8090048      0.0000000000000	0.0000000000000 0.045024238144	0.0000000000000
    0.9988557      0.0000000000000	0.0000000000000 0.099589645015	0.0000000000000
    0.5709019      0.0000000000000	0.0000000000000 0.185117675279	0.0000000000000
    0.3356325      0.0000000000000	0.0000000000000 0.272215006419	0.0000000000000
    0.2018174      0.0000000000000	0.0000000000000 0.287038979472	0.0000000000000
    0.1233308      0.0000000000000	0.0000000000000 0.185359431716	0.0000000000000
    0.0758117      0.0000000000000	0.0000000000000 0.055951602281	0.0000000000000
    0.0456601      0.0000000000000	0.0000000000000 0.004428704232	0.0000000000000
20341.4072055      0.0000000000000	0.0000000000000	0.0000000000000 0.000013589949
 5314.7889527      0.0000000000000	0.0000000000000	0.0000000000000 0.000098737858
 1909.2843277      0.0000000000000	0.0000000000000	0.0000000000000 0.000479801845
  804.8608789      0.0000000000000	0.0000000000000	0.0000000000000 0.001857311798
  375.4685216      0.0000000000000	0.0000000000000	0.0000000000000 0.006124920625
  188.1771220      0.0000000000000	0.0000000000000	0.0000000000000 0.017694065197
   99.5609965      0.0000000000000	0.0000000000000	0.0000000000000 0.045024238144
   54.9733556      0.0000000000000	0.0000000000000	0.0000000000000 0.099589645015
   31.4203488      0.0000000000000	0.0000000000000	0.0000000000000 0.185117675279
   18.4719839      0.0000000000000	0.0000000000000	0.0000000000000 0.272215006419
   11.1072908      0.0000000000000	0.0000000000000	0.0000000000000 0.287038979472
    6.7876756      0.0000000000000	0.0000000000000	0.0000000000000 0.185359431716
    4.1723989      0.0000000000000	0.0000000000000	0.0000000000000 0.055951602281
    2.5129657      0.0000000000000	0.0000000000000	0.0000000000000 0.004428704232

N	D
 317.9739222      0.000007211834
 102.3927402      0.000064571730
  42.7819062      0.000370632597
  20.4102119      0.001645715217
  10.5965121      0.006063213603
   5.8420446      0.019041368835
   3.3705501      0.051097955816
   2.0154026      0.115162924520
   1.2402339      0.209894375084
   0.7810721      0.290459604554
   0.5007960      0.276700110656
   0.3249025      0.155660868486
   0.2111809      0.039819181169
   0.1341367      0.002624443047
'''
#)}

mol.basis = 'ccpvdz'
mol.charge = 0
mol.spin = 0 
mol.verbose = 0
mol.build(0, 0)
mol.symmetry = 'dooh'
print("start mf")
mf = scf.RHF(mol).run()

eps_var = [1e-2, 5e-3, 1e-3]
eps_var_sched = eps_var
shci_cmd = '/home/tanderson/Projects/dmc/dmc/bin/run_shci .'
shci_path = 'shci.out'
num_dets = 100
out_name = 'dmc.in'
print("start dmc")
dmc.make_dmc(mol, mf, eps_var, eps_var_sched, 
        shci_cmd, shci_path, num_dets, out_name)
